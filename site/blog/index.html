<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Blog - Paul Smith</title>
    <meta name="description" content="Paul Smith, programmer, EveryBlock co-founder">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans:regular,bold|Inconsolata|Droid+Serif:regular,bold">
    <!--[if gte IE 7]><!-->
    <link rel="stylesheet" media="screen, projection" href="/css/base.css" type="text/css">
    <!-- <![endif]-->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css">
    <link rel="alternate" href="/atom.xml" type="application/atom+xml">
    <link rel="openid.server" href="http://www.myopenid.com/server/">
    <link rel="openid.delegate" href="http://pauladamsmith.myopenid.com/">
    <meta name="verify-v1" content="JGWpUVGeSZp407VK35oscFKsTMIEalzD8cTIBcScWNQ=">
    
  </head>
  <body class="blog">
    <header>
      <h1><a href="/">Paul Smith</a></h1>
      <nav>
        <ul>
          <li><a href="/about.html">About</a></li>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/articles/">Articles</a></li>
          <li><a href="/projects.html">Projects</a></li>
        </ul>
      </nav>
    </header>
    <div id="main">
      
<article class="post">
  <header>
    <h1><a href="/blog/2011/03/redis_get_set.html" title="Permalink to this post">More Redis internals: Tracing a GET & SET</a></h1>
    <time datetime="2011-03-10" pubdate>March 10, 2011</time>
  </header>
  <p>In my <a href="/articles/redis-under-the-hood.html">previous article</a>, I took a
superficial look at how Redis starts up and prepares itself to process
commands. In this article, I'll follow a <code>GET</code> and a <code>SET</code> command as
they move from client through the server and back. The <code>GET</code> will be for
a key that doesn't exist, and the <code>SET</code> will set that key.  Then I'll look
quickly at a subsequent <code>GET</code> and how it differs.</p>
<p>As before, I'm exploring Redis with the source code open in my editor and
indexed with a <code>tags</code> file, and the Redis server running under <code>gdb</code> in
another terminal.</p>
<p>Caveat: this article was written against the codebase of Redis 2.2.1. With
respect to my previous article, for a list of what has changed in Redis since
I wrote it, see this <a href="http://news.ycombinator.com/item?id=2301804">comment on
HN</a>.</p>
<h1>GET</h1>
<p>Let's execute the command <code>get users:1234</code> on Redis.</p>
<h2>Preparing</h2>
<p>If you inspect certain variables under <code>gdb</code>, you might not get what you want.
Instead you see a message like "<value temporarily unavailable, due to
optimizations>." This is because the compiler has optimized the machine code
in such a fashion that the portion of memory you wanted to look at that was
never used, at least for the variable under inspection. To make stepping
through the code and inspecting a little easier, we make sure that Redis is
not compiled with optimizations. I did this by replacing the line in
<code>src/Makefile</code>:</p>
<div class="codehilite"><pre><span class="n">OPTIMIZATION</span><span class="p">?</span><span class="o">=-</span><span class="n">O2</span>
</pre></div>


<p>with:</p>
<div class="codehilite"><pre><span class="n">OPTIMIZATION</span><span class="p">?</span><span class="o">=</span>
</pre></div>


<p>and then typing <code>make</code> as normal.</p>
<h2>Sending the command from the client</h2>
<p>If we look at the <code>repl</code> loop of redis-cli, we see that it uses the
<code>linenoise</code> library to split the arguments of the command. It dispatches on
the first argument. The loop checks for client commands that aren't processed
as a command by the Redis server, like <code>exit</code>/<code>quit</code>, <code>clear</code> (to clear the screen),
and <code>connect</code> (which is a way to connect to a specified Redis server on host
port, instead of the default host of 127.0.0.1 and port of 6379.</p>
<p>Any other argument is considered the name of a command to send to the server.
The remaining arguments are the arugments for that command.</p>
<p>We're trying to get the on-the-wire representation of the <code>get users:1234</code> command.
redis-cli uses a <code>redisContext</code> struct to encapsulate the state of the
connection to the server, as well as the output buffer where the command in
the form of the Redis protocol is written for sending to the server. We know
from reading the source of hiredis (the Redis C client library that the redis-cli
program is built on) that the <code>obuf</code> field is where the raw command is stored:</p>
<div class="codehilite"><pre><span class="cp"># hiredis.h:107</span>
<span class="cm">/* Context for a connection to Redis */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">redisContext</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">flags</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">obuf</span><span class="p">;</span> <span class="cm">/* Write buffer */</span>
    <span class="kt">int</span> <span class="n">err</span><span class="p">;</span> <span class="cm">/* Error flags, 0 when there is no error */</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">errstr</span><span class="p">;</span> <span class="cm">/* String representation of error when applicable */</span>

    <span class="cm">/* Function set for reply buildup and reply reader */</span>
    <span class="n">redisReplyObjectFunctions</span> <span class="o">*</span><span class="n">fn</span><span class="p">;</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">reader</span><span class="p">;</span>
<span class="p">}</span> <span class="n">redisContext</span><span class="p">;</span>
</pre></div>


<p>If we set a breakpoint on <code>cliReadReply</code>, we can inspect the output buffer and
see exactly how the command looks as a bytestring bound for the server.</p>
<div class="codehilite"><pre>client $ gdb src/redis-cli
(gdb) b cliReadReply
(gdb) run
Starting program: /home/paul/src/redis-2.2.0-RC2/src/redis-cli 
Reading symbols for shared libraries +. done
redis&gt; get users:1234

Breakpoint 1, cliReadReply (output_raw_strings=0) at redis-cli.c:421
421         if (redisGetReply(context,&amp;_reply) != REDIS_OK) {
(gdb) p context-&gt;obuf 
$1 = 0x100102428 &quot;*2\r\n$3\r\nget\r\n$10\r\nusers:1234\r\n&quot;
</pre></div>


<p>We see that the Redis command <code>get users:1234</code> as entered in our client is
translated to <code>*2\r\n$3\r\nget\r\n$10\r\nusers:1234\r\n</code>. Any Redis client is
going to convert our command expressed in its respective syntax to the same
on-the-wire format. So in Python:</p>
<div class="codehilite"><pre>&gt;&gt;&gt; redis_client.get(&#39;users:1234&#39;)
</pre></div>


<p>will send the same <code>*2\r\n$3\r\nget\r\n$10\r\nusers:1234\r\n</code> bytestring to
the server. </p>
<p>Let's print that bytestring to screen and render those `rn's as line feeds
so we can see an expanded view and get a better look at the protocol.</p>
<div class="codehilite"><pre>*2
$3
get
$10
users:1234
</pre></div>


<p>The first bit is <code>*2</code>, which tells us that the arity of the command,
including the command name, is 2. That is, the server should expect two
arguments to follow.</p>
<p>The next bit is <code>$3</code>, which means that the length of the first argument in
bytes is 3. The argument itself follows, our command name, <code>get</code>.</p>
<p>The next bit after that is <code>$10</code>, so the length in bytes of the second
argument is 10. Our one and only argument to the command is next,
<code>users:1234</code>, the key we are trying to <code>get</code>.</p>
<h2>Receiving the command on the server</h2>
<p>If you remember from the last article, <code>readQueryFromClient</code> is a good place
to set a breakpoint in your debugger on the server side for inspecting an
inbound client command.</p>
<div class="codehilite"><pre>server $ gdb src/redis-server
(gdb) b readQueryFromClient
Breakpoint 1 at 0x100011445: file networking.c, line 882.
(gdb) run redis.conf
Starting program: /home/paul/src/redis-2.2.0-RC2/src/redis-server redis.conf
Reading symbols for shared libraries +. done
[63700] 01 Mar 11:04:40 * Server started, Redis version 2.2.1
[63700] 01 Mar 11:04:40 * The server is now ready to accept connections on port 6379
</pre></div>


<p>Now back in the terminal with the client running in the debugger, continue to
send the command to the server, which will stop at the breakpoint we set.</p>
<div class="codehilite"><pre># client
(gdb) c
Continuing.

# server
Breakpoint 1, readQueryFromClient (el=0x100200000, fd=5, privdata=0x100804e00, mask=1) at networking.c:801
801     void readQueryFromClient(aeEventLoop *el, int fd, void *privdata, int mask) {
</pre></div>


<p>Let's step to the following line:</p>
<div class="codehilite"><pre><span class="cp"># src/networking.c:808</span>
<span class="n">nread</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">REDIS_IOBUF_LEN</span><span class="p">);</span>
</pre></div>


<p>If we step to here in our debugger, we see that the server read 30 bytes. If
you count the number of bytes in our Redis protocol-encoded command,
<code>*2\r\n$3\r\nget\r\n$10\r\nusers:1234\r\n</code>, you'll see it's 30. Just for good
measure, let's look at the 30 bytes beginning at the memory location pointed
to by <code>buf</code>:</p>
<div class="codehilite"><pre>(gdb) p nread
30
(gdb) x/30cb buf
0x7fff5fbfeaf0: 42 &#39;*&#39;  50 &#39;2&#39;  13 &#39;\r&#39; 10 &#39;\n&#39; 36 &#39;$&#39;  51 &#39;3&#39;  13 &#39;\r&#39; 10 &#39;\n&#39;
0x7fff5fbfeaf8: 71 &#39;G&#39;  69 &#39;E&#39;  84 &#39;T&#39;  13 &#39;\r&#39; 10 &#39;\n&#39; 36 &#39;$&#39;  49 &#39;1&#39;  48 &#39;0&#39;
0x7fff5fbfeb00: 13 &#39;\r&#39; 10 &#39;\n&#39; 117 &#39;u&#39; 115 &#39;s&#39; 101 &#39;e&#39; 114 &#39;r&#39; 115 &#39;s&#39; 58 &#39;:&#39;
0x7fff5fbfeb08: 49 &#39;1&#39;  50 &#39;2&#39;  51 &#39;3&#39;  52 &#39;4&#39;  13 &#39;\r&#39; 10 &#39;\n&#39;
</pre></div>


<p>And we can see our whole command bytestring is there, byte by byte.</p>
<p>The server has now read in the entirety of our command in one step.  (Because
we had a relatively short command, one that fits inside a kernel buffer, and
we are the only client on a loopback network device, this is the case, but it
need not be. Since Redis is event-driven, this function,
<code>readQueryFromClient</code>, is called whenever there are bytes from buffers to be
read. If our command was particularly long, or there was a lot of network
contention, the command may take more than one I/O event before it is fully
read. For this reason, Redis builds up a buffer per client and appends bytes
to it on each call to this function. It only proceeds with processing the
command when it has been fully read. But we don't need to consider this in our
simple example, so we will proceed.)</p>
<p>We're going to elide the processing of the input buffer. This is the point
where the server takes the Redis protocol-encoded bytestring of our request
and unpacks it into arguments on the client struct object. If you are
interested in the details of that parsing, examine the function
<code>processMultibulkBuffer</code> in <code>networking.c</code>. All we are interested in at this
point is that the <code>argc</code> member of the client object is the number of command
arguments (counting the command name itself) and <code>argv</code> is a pointer to the
list of arguments.</p>
<p>The bit of code we care at this point is <code>processCommand</code>. The first thing the
server does is look up the command in its command table (see "Setting up
command table" in the previous article, but note that this lookup is now O(1),
see the HN thread linked above). Assuming the command is found (which our
<code>get</code> will be), the server will double-check that the arity of the command as
defined in the command table matches the number of arguments received from the
client (<code>c-&gt;argc</code>).</p>
<div class="codehilite"><pre><span class="cp"># redis.c:998</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="n">lookupCommand</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cmd</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">addReplyErrorFormat</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="s">&quot;unknown command &#39;%s&#39;&quot;</span><span class="p">,</span>
        <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">REDIS_OK</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">arity</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">arity</span> <span class="o">!=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">argc</span><span class="p">)</span> <span class="o">||</span>
           <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">arity</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">addReplyErrorFormat</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="s">&quot;wrong number of arguments for &#39;%s&#39; command&quot;</span><span class="p">,</span>
        <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">REDIS_OK</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Skip down to the end of <code>processCommand</code>. Because our humble <code>get</code> is not a
"multi" command like <code>mget</code>, <code>mset</code>, etc., it doesn't require queue-like
processing of the underlying multiple commands, so we go right to <code>call</code>,
which is where our command is dispatched.</p>
<div class="codehilite"><pre><span class="cp"># redis.c:953</span>
<span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">redisClient</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">struct</span> <span class="n">redisCommand</span> <span class="o">*</span><span class="n">cmd</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">dirty</span><span class="p">;</span>

    <span class="n">dirty</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">dirty</span><span class="p">;</span>
    <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">proc</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="n">dirty</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">dirty</span><span class="o">-</span><span class="n">dirty</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="n">appendonly</span> <span class="o">&amp;&amp;</span> <span class="n">dirty</span><span class="p">)</span>
        <span class="n">feedAppendOnlyFile</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">argv</span><span class="p">,</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">argc</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">dirty</span> <span class="o">||</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">REDIS_CMD_FORCE_REPLICATION</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="n">listLength</span><span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="n">slaves</span><span class="p">))</span>
        <span class="n">replicationFeedSlaves</span><span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="n">slaves</span><span class="p">,</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">argv</span><span class="p">,</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">argc</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">listLength</span><span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="n">monitors</span><span class="p">))</span>
        <span class="n">replicationFeedMonitors</span><span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="n">monitors</span><span class="p">,</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">argv</span><span class="p">,</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">argc</span><span class="p">);</span>
    <span class="n">server</span><span class="p">.</span><span class="n">stat_numcommands</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Let's focus on line 952, <code>cmd-&gt;proc(c);</code>. This is Redis's dynamic dispatching
of command function calling. Redis makes this clean and simple by
encapsulating commands and giving all the actual underlying command functions
the same function signature, taking our client object, which carries the
payload of our command's arguments. So we're interested in looking into the
details of the Redis command object and the actual function that will handle
our <code>get</code>.</p>
<div class="codehilite"><pre><span class="cp"># redis.h:504</span>
<span class="k">struct</span> <span class="n">redisCommand</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
    <span class="n">redisCommandProc</span> <span class="o">*</span><span class="n">proc</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">arity</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">flags</span><span class="p">;</span>
    <span class="cm">/* Use a function to determine which keys need to be loaded</span>
<span class="cm">     * in the background prior to executing this command. Takes precedence</span>
<span class="cm">     * over vm_firstkey and others, ignored when NULL */</span>
    <span class="n">redisVmPreloadProc</span> <span class="o">*</span><span class="n">vm_preload_proc</span><span class="p">;</span>
    <span class="cm">/* What keys should be loaded in background when calling this command? */</span>
    <span class="kt">int</span> <span class="n">vm_firstkey</span><span class="p">;</span> <span class="cm">/* The first argument that&#39;s a key (0 = no keys) */</span>
    <span class="kt">int</span> <span class="n">vm_lastkey</span><span class="p">;</span>  <span class="cm">/* THe last argument that&#39;s a key */</span>
    <span class="kt">int</span> <span class="n">vm_keystep</span><span class="p">;</span>  <span class="cm">/* The step between first and last key */</span>
<span class="p">};</span>
</pre></div>


<p>If we pop up to the top of <code>redis.c</code>, we see the definition of the Redis command
table, and our <code>get</code> is the first entry.</p>
<div class="codehilite"><pre><span class="cp"># redis.c:71</span>
<span class="k">struct</span> <span class="n">redisCommand</span> <span class="n">readonlyCommandTable</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span><span class="s">&quot;get&quot;</span><span class="p">,</span><span class="n">getCommand</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">},</span>
</pre></div>


<p><code>getCommand</code> is the function that does the actual work for our command.
It's a thin wrapper for <code>getGenericCommand</code>.</p>
<div class="codehilite"><pre><span class="cp"># t_string.c:62</span>
<span class="kt">int</span> <span class="nf">getGenericCommand</span><span class="p">(</span><span class="n">redisClient</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">robj</span> <span class="o">*</span><span class="n">o</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">o</span> <span class="o">=</span> <span class="n">lookupKeyReadOrReply</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">shared</span><span class="p">.</span><span class="n">nullbulk</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">REDIS_OK</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">o</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">!=</span> <span class="n">REDIS_STRING</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">addReply</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">shared</span><span class="p">.</span><span class="n">wrongtypeerr</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">REDIS_ERR</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">addReplyBulk</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">o</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">REDIS_OK</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">getCommand</span><span class="p">(</span><span class="n">redisClient</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">getGenericCommand</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>The arguments to <code>lookupKeyReadOrReply</code> are the client object, the key
<code>users:1234</code> we're trying to look up, and an object, <code>shared.nullbulk</code> that
will be the default reply to the client if the key is not found.</p>
<div class="codehilite"><pre><span class="cp"># db.c:58</span>
<span class="n">robj</span> <span class="o">*</span><span class="nf">lookupKeyReadOrReply</span><span class="p">(</span><span class="n">redisClient</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="n">robj</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="n">robj</span> <span class="o">*</span><span class="n">reply</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">robj</span> <span class="o">*</span><span class="n">o</span> <span class="o">=</span> <span class="n">lookupKeyRead</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">db</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">o</span><span class="p">)</span> <span class="n">addReply</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">reply</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p><code>lookupKeyRead</code> is a thin wrapper for <code>lookupKey</code> that handles removing keys
that have been set to expire.</p>
<p>Now we get to the heart of the <code>get</code> command -- looking up the key in the
database.</p>
<div class="codehilite"><pre><span class="cp"># db.c:9</span>
<span class="n">robj</span> <span class="o">*</span><span class="nf">lookupKey</span><span class="p">(</span><span class="n">redisDb</span> <span class="o">*</span><span class="n">db</span><span class="p">,</span> <span class="n">robj</span> <span class="o">*</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">dictEntry</span> <span class="o">*</span><span class="n">de</span> <span class="o">=</span> <span class="n">dictFind</span><span class="p">(</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">dict</span><span class="p">,</span><span class="n">key</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">de</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">robj</span> <span class="o">*</span><span class="n">val</span> <span class="o">=</span> <span class="n">dictGetEntryVal</span><span class="p">(</span><span class="n">de</span><span class="p">);</span>

        <span class="cm">/* Update the access time for the aging algorithm.</span>
<span class="cm">         * Don&#39;t do it if we have a saving child, as this will trigger</span>
<span class="cm">         * a copy on write madness. */</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="n">bgsavechildpid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">server</span><span class="p">.</span><span class="n">bgrewritechildpid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">val</span><span class="o">-&gt;</span><span class="n">lru</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">lruclock</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="n">vm_enabled</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="o">-&gt;</span><span class="n">storage</span> <span class="o">==</span> <span class="n">REDIS_VM_MEMORY</span> <span class="o">||</span>
                <span class="n">val</span><span class="o">-&gt;</span><span class="n">storage</span> <span class="o">==</span> <span class="n">REDIS_VM_SWAPPING</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="cm">/* If we were swapping the object out, cancel the operation */</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="o">-&gt;</span><span class="n">storage</span> <span class="o">==</span> <span class="n">REDIS_VM_SWAPPING</span><span class="p">)</span>
                    <span class="n">vmCancelThreadedIOJob</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">notify</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span><span class="o">-&gt;</span><span class="n">storage</span> <span class="o">==</span> <span class="n">REDIS_VM_LOADING</span><span class="p">);</span>

                <span class="cm">/* Our value was swapped on disk. Bring it at home. */</span>
                <span class="n">redisAssert</span><span class="p">(</span><span class="n">val</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">REDIS_VMPOINTER</span><span class="p">);</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">vmLoadObject</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
                <span class="n">dictGetEntryVal</span><span class="p">(</span><span class="n">de</span><span class="p">)</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>

                <span class="cm">/* Clients blocked by the VM subsystem may be waiting for</span>
<span class="cm">                 * this key... */</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">notify</span><span class="p">)</span> <span class="n">handleClientsBlockedOnSwappedKey</span><span class="p">(</span><span class="n">db</span><span class="p">,</span><span class="n">key</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">server</span><span class="p">.</span><span class="n">stat_keyspace_hits</span><span class="o">++</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">val</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">server</span><span class="p">.</span><span class="n">stat_keyspace_misses</span><span class="o">++</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Redis uses its own hash table implementation to store keys and their values in
memory. Inside the <code>db</code> object, the field <code>dict</code> is a pointer to the hash
value for the current Redis database (remember there can be up to 16 separate
databases in a single Redis server instance, indexed by number).</p>
<p>First, Redis calls <code>dictFind</code> with the database's hash table and a pointer to
the key's bytestring (the key is a Redis object of type <code>robj</code> -- all keys and
values in the Redis hash table is a Redis object). <code>dictFind</code> looks up the
hash of the key in the table, using a standard algorithm that should be
familiar to anyone who's implemented a hash table (check out <code>dict.c</code> starting
at line 391 if you're interested, the table is an array with linked lists for
colliding hashes).</p>
<p>If the key is found in the table, <code>dictFind</code> returns a pointer to the entry in
the table. Otherwise, it returns <code>NULL</code>. Back in <code>lookupKey</code>, if the entry is
not null, Redis retrieves the value (i.e., the Redis object our key
references) from the hash table via <code>dictGetEntryVal</code> and takes care of a bit
of bookkeeping for expiry and VM, if the key was found, and stats in either
case (hits and misses). If the entry was <code>NULL</code>, then <code>lookupKey</code> also returns
<code>NULL</code>; we'll see how this is handled by Redis for a reply to the client when
the key is not found, which is the case for us at this stage.</p>
<p>With the value of <code>lookupKey</code>, we'll go back up the stack to our callers. Back
to <code>lookupKeyReadOrReply</code>, we look at line 60:</p>
<div class="codehilite"><pre><span class="cp"># t_string.c:60</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">o</span><span class="p">)</span> <span class="n">addReply</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">reply</span><span class="p">);</span>
</pre></div>


<p>Since we got <code>NULL</code> from <code>lookupKey</code> this time, we call <code>addReply</code>.  The value
of <code>reply</code> here comes from the call in <code>getGenericCommand</code>, and it is
<code>shared.nullbulk</code>. This field in the global struct object <code>shared</code> is
initialize thusly:</p>
<div class="codehilite"><pre><span class="cp"># redis.c:712</span>
<span class="n">shared</span><span class="p">.</span><span class="n">nullbulk</span> <span class="o">=</span> <span class="n">createObject</span><span class="p">(</span><span class="n">REDIS_STRING</span><span class="p">,</span><span class="n">sdsnew</span><span class="p">(</span><span class="s">&quot;$-1</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">));</span>
</pre></div>


<p>We can see that it is a Redis string object who's on-the-wire value is
<code>$-1\r\n</code>, meaning a length of -1, Redis's way of indicating null to a
client, according to the protocol.</p>
<p><code>addReply</code> builds the reply to the client. It does this by first setting up a
write event on the main event loop listener with <code>_installWriteEvent</code>. This
makes sure that the reply is written out to the client connection when there
are bytes present in the buffer. Next, Redis adds the reply to the client's
buffer. If the reply object were an non-string value like an integer, or a
list, or a set, Redis would first decode it to a bytestring that can be
serialized to, for example, on a socket. Redis string objects are encoded
"raw," or as-is. The <code>nullbulk</code> object is technically a string object, so no
decoding is necessary in our case. In any case, the reply bytestring is copied
to the client's reply buffer with <code>_addReplyToBuffer</code>, which for all intents
and purposes completes the execution of our <code>get</code> command on the server.</p>
<p>The client will read the on-the-wire reply of <code>$-1\r\n</code> and know that it is a
string reply of length -1, and therefore is the null (or "nil," in the context
of <code>redis-cli</code>) object, and to convert that into the appropriate object for
the language of the client. Back to our <code>redis-cli</code> client patiently waiting
for a reply from our breakpointed server, which we continue from, that looks
like:</p>
<div class="codehilite"><pre>(nil)
redis&gt;
</pre></div>


<h1>SET</h1>
<p>The <code>set</code> command proceeds much the same way as the <code>get</code>, up to the point of
command dispatching on the server.</p>
<div class="codehilite"><pre># client
redis&gt; set users:1234 &quot;Paul Smith&quot;

# server
Breakpoint 1, readQueryFromClient (el=0x100400000, fd=6, privdata=0x100805e00, mask=1) at networking.c:801
801     void readQueryFromClient(aeEventLoop *el, int fd, void *privdata, int mask) {
(gdb) n
802         redisClient *c = (redisClient*) privdata;
(gdb) n
808         nread = read(fd, buf, REDIS_IOBUF_LEN);
(gdb) n
809         if (nread == -1) {
(gdb) print nread
$1 = 47
(gdb) x/47cb buf
0x7fff5fbfeba0: 42 &#39;*&#39;  51 &#39;3&#39;  13 &#39;\r&#39; 10 &#39;\n&#39; 36 &#39;$&#39;  51 &#39;3&#39;  13 &#39;\r&#39; 10 &#39;\n&#39;
0x7fff5fbfeba8: 115 &#39;s&#39; 101 &#39;e&#39; 116 &#39;t&#39; 13 &#39;\r&#39; 10 &#39;\n&#39; 36 &#39;$&#39;  49 &#39;1&#39;  48 &#39;0&#39;
0x7fff5fbfebb0: 13 &#39;\r&#39; 10 &#39;\n&#39; 117 &#39;u&#39; 115 &#39;s&#39; 101 &#39;e&#39; 114 &#39;r&#39; 115 &#39;s&#39; 58 &#39;:&#39;
0x7fff5fbfebb8: 49 &#39;1&#39;  50 &#39;2&#39;  51 &#39;3&#39;  52 &#39;4&#39;  13 &#39;\r&#39; 10 &#39;\n&#39; 36 &#39;$&#39;  49 &#39;1&#39;
0x7fff5fbfebc0: 48 &#39;0&#39;  13 &#39;\r&#39; 10 &#39;\n&#39; 80 &#39;P&#39;  97 &#39;a&#39;  117 &#39;u&#39; 108 &#39;l&#39; 32 &#39; &#39;
0x7fff5fbfebc8: 83 &#39;S&#39;  109 &#39;m&#39; 105 &#39;i&#39; 116 &#39;t&#39; 104 &#39;h&#39; 13 &#39;\r&#39; 10 &#39;\n&#39;
(gdb) print (char *)buf
$2 = 0x7fff5fbfeba0 &quot;*3\r\n$3\r\nset\r\n$10\r\nusers:1234\r\n$10\r\nPaul Smith\r\n&quot;
</pre></div>


<p>This time, our protocol-encoded bytestring is 47 bytes long, owing to the
extra argument "Paul Smith" and the length tag it requires. Also notice the
leading <code>*3</code> indicates there are three arguments: <code>set</code>, <code>users:1234</code>, <code>Paul Smith</code>.</p>
<p>Let's skip ahead now to the point in <code>call</code> in <code>redis.c</code>, after the command has
been looked-up in the command table and the server is about ready to call the
underlying <code>proc</code> function with the client object argument. The <code>set</code> command,
in the form of a <code>redisCommand</code> struct, looks like this:</p>
<div class="codehilite"><pre><span class="cp"># redis.c:73</span>
<span class="p">{</span><span class="s">&quot;set&quot;</span><span class="p">,</span><span class="n">setCommand</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">REDIS_CMD_DENYOOM</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">},</span>
</pre></div>


<p>Notice that the arity of the command is 3, which includes the leading command
name, plus key and value, and matches what we expect from the client. The
<code>set</code> command has a flag that <code>get</code> did not: the constant <code>REDIS_CMD_DENYOOM</code>
means that, in out-of-memory situations where Redis can't allocate any more
memory, the execution of the command should be denied. (The absence of this
flag means that Redis can continue to serve client "read" requests like <code>get</code>
even when the server can no longer write any new data.)</p>
<p>I set a breakpoint on <code>setCommand</code> and let the server continue running until
that point:</p>
<div class="codehilite"><pre># server
(gdb) b setCommand
Breakpoint 2 at 0x10001a6e2: file t_string.c, line 48.
(gdb) c
Continuing.
Breakpoint 2, setCommand (c=0x100805e00) at t_string.c:48
48          c-&gt;argv[2] = tryObjectEncoding(c-&gt;argv[2]);
</pre></div>


<p>Incidentally, you can inspect the values of the client's command arguments at
any time, with a simple <code>gdb</code> invocation. The arguments are of type <code>robj</code>,
which has a field <code>ptr</code> that is a pointer to the actual value in memory. Since
in our <code>set</code> case these are strings, we can inspect them by typecasting to
<code>char *</code> like so:</p>
<div class="codehilite"><pre>(gdb) p (char *)c-&gt;argv[0]-&gt;ptr
$10 = 0x10032ae78 &quot;set&quot;
(gdb) p (char *)c-&gt;argv[1]-&gt;ptr
$11 = 0x10032b068 &quot;users:1234&quot;
(gdb) p (char *)c-&gt;argv[2]-&gt;ptr
$12 = 0x10032b098 &quot;Paul Smith&quot;
</pre></div>


<p>The first thing the server does in <code>setCommand</code> is encode the value being set
with <code>tryObjectEncoding</code>. It will try to create an efficient encoding if the
bytestring can be interpreted as an integer, for example. This can save space
especially in the case where many numbers are being stored.  Additionally,
Redis will try to reuse shared integers as values instead of allocating
resources for new ones -- see the previous article for more on the creation
and use of shared integers.</p>
<p>Once the value being set has been encoded, <code>setGenericCommand</code> is called
(<code>set</code> shares <code>setGenericCommand</code> with the <code>setnx</code> and <code>setex</code> commands). From
here, <code>dbAdd</code> is called, with the client, key, and value as arguments. <code>dbAdd</code>
will only add the value to the database's hash table if the key does not
already exist. In our case, since the key <code>users:1234</code> does not exist, the
value of <code>dictFind</code> is null, and the function proceeds to add the value with
<code>dictAdd</code>.</p>
<p><code>dictAdd</code> takes the dictionary hash table, key, and value as arguments. It
uses <code>_dictKeyIndex</code> to find the index of a free slot in the hash table for
our new entry. See the implementation in <code>dict.c</code> and <code>dict.h</code> for the details
of key hashing, and the structure of the dictionary and its component hash
tables (each Redis dictionary contains two hash tables in order to provide
incremental rehashing as the dictionary grows). <code>dictAdd</code> allocates memory for
the new entry and stores it in the new index.</p>
<p>The server returns back up the stack from <code>dictAdd</code> and <code>dbAdd</code> to
<code>setGenericCommand</code>, where it increments the reference count on our new value.
Redis uses reference counting in order to free memory used by values that have
been deleted or have expired. It then "touches" the key so that if any clients
are <code>watch</code>ing the key, the next <code>exec</code> command will fail. It also increments
the server's <code>dirty</code> flag, which it uses to determine when to write out the
dump file to disk. Finally, it writes out the reply to the client, which is a
shared object, <code>shared.ok</code>. This is special Redis string object in the
protocol that consists of the bytestring "+OKrn". Clients will typically
convert this into the equivalent "true" value for their language.</p>
<h1>GET redux</h1>
<p>Our key is now set, so we can try the <code>get users:1234</code> command again and see
how it differs for a found key.</p>
<div class="codehilite"><pre><span class="cp"># db.c:9</span>
<span class="n">robj</span> <span class="o">*</span><span class="nf">lookupKey</span><span class="p">(</span><span class="n">redisDb</span> <span class="o">*</span><span class="n">db</span><span class="p">,</span> <span class="n">robj</span> <span class="o">*</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">dictEntry</span> <span class="o">*</span><span class="n">de</span> <span class="o">=</span> <span class="n">dictFind</span><span class="p">(</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">dict</span><span class="p">,</span><span class="n">key</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">de</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">robj</span> <span class="o">*</span><span class="n">val</span> <span class="o">=</span> <span class="n">dictGetEntryVal</span><span class="p">(</span><span class="n">de</span><span class="p">);</span>

        <span class="c1">// ... skipping the lru &amp; vm parts ...</span>

        <span class="n">server</span><span class="p">.</span><span class="n">stat_keyspace_hits</span><span class="o">++</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">val</span><span class="p">;</span>
</pre></div>


<p>The point where a <code>get</code> on an existing key and a <code>get</code> on a non-existent key
differ is line 11, where the <code>de</code> entry in the database's dictionary is found.
<code>dictGetEntryVal</code> is a simple macro for accessing the field in the <code>de</code> struct
that carries the value associated with the key. Redis updates its statistics
to indicate a key hit and returns the value object.</p>
<p>Again, as with the key miss from above (remember the null value is a Redis
object, too), the value is decoded into the Redis bytestring protocol. This is
the response to the client, and we have concluded our <code>GET</code>/<code>SET</code>/<code>GET</code> dance.</p>
  </article>
<article class="post">
  <header>
    <h1><a href="/blog/2011/01/bluecollarleague.html" title="Permalink to this post">The All-Blue-Collar League</a></h1>
    <time datetime="2011-01-24" pubdate>January 24, 2011</time>
  </header>
  <p>In honor of the <a href="http://sportsillustrated.cnn.com/football/nfl/gameflash/2011/01/23/4353_recap.html?&amp;eref=sihp">all</a>-<a href="http://sportsillustrated.cnn.com/football/nfl/gameflash/2011/01/23/4354_recap.html?eref=sihp">union</a> Super Bowl, I present the
All-Blue-Collar League, a collection of U.S. professional sports franchises
named after local unions, industry.</p>
<p>In solidarity:</p>
<table id="teams">
    <tr>
        <th>NFL</th>
    </tr>
    <tr class="team packers" title="Named after the Indian Packing Company">
        <td><span></span>Green Bay <b>Packers</b></td>
    </tr>
    <tr class="team steelers" title="Pittsburgh’s economy centered around the steel industry for many years.">
        <td><span></span>Pittsburgh <b>Steelers</b></td>
    </tr>
    <tr class="team cowboys" title="Texas cowboys were freelance livestock herders and handlers.">
        <td><span></span>Dallas <b>Cowboys</b></td>
    </tr>

<tr>
        <th>MLB</th>
    </tr>
    <tr class="team astros" title="NASA’s Johnson Space Center and the greater space industry is a huge employer in the Houston region.">
        <td><span></span>Houston <b>Astros</b></td>
    </tr>
    <tr class="team brewers" title="Named for the city’s association with the beer brewing industry.">
        <td><span></span>Milwaukee <b>Brewers</b></td>
    </tr>
    <tr class="team mariners" title="The city’s location makes it a natural for many maritime industries, including fishmongering, and fishwivery.">
        <td><span></span>Seattle <b>Mariners</b></td>
    </tr>
    <tr class="team rangers" title="The Texas Rangers have been a statewide law enforcement agency since 1823, the oldest such agency in the U.S.">
        <td><span></span>Texas <b>Rangers</b></td>
    </tr>

<tr>
        <th>NBA</th>
    </tr>
    <tr class="team pistons" title="Detroit is synonymous with the American auto industry, a source of high-quality middle-class jobs for most of the 20th century.">
        <td><span></span>Detroit <b>Pistons</b></td>
    </tr>

<tr>
        <th>NHL</th>
    </tr>
    <tr class="team oilers" title="Edmonton is one of Canada’s major oil refinery centers.">
        <td><span></span>Edmonton <b>Oilers</b></td>
    </tr>
</table>

<p>Thanks to <a href="http://twitter.com/kostuch">@kostuch</a>, <a href="http://twitter.com/ikesmith">@ikesmith</a>, <a href="http://twitter.com/joshandrews">@joshandrews</a>, <a href="http://twitter.com/tcarmody">@tcarmody</a>,
<a href="http://twitter.com/lmsahistory">@lmsahistory</a>, and <a href="http://twitter.com/janieporche">@janieporche</a> for suggestions.</p>
<style>
#teams {
    width: 100%;
    margin-bottom: 1em;
}

#teams tr {
    clear: both;
}

#teams th {
    padding: 5px 6px;
}

#teams th {
    background: hsla(215, 35%, 35%, 1.0);
    color: white;
}

#teams td {
    height: 50px;
    line-height: 50px;
    padding: 5px 0;
    border-bottom: 1px solid hsla(215, 35%, 35%, 0.5);
}

#teams td span {
    display: block;
    float: left;
    height: 50px;
    width: 50px;
    margin-right: 10px;
    background-image: url(/images/blue_collar_sprite.png);
    background-repeat: no-repeat;
}

#teams .explanation {
    display: none;
}

.brewers td span { background-position: -50px 0px; }
.cowboys td span { background-position: -100px 0px; }
.mariners td span { background-position: -150px 0px; }
.oilers td span { background-position: -200px 0px; }
.packers td span { background-position: -250px 0px; }
.pistons td span { background-position: -300px 0px; }
.rangers td span { background-position: -350px 0px; }
.steelers td span { background-position: -400px 0px; }
</style>
  </article>
<article class="post">
  <header>
    <h1><a href="/blog/2011/01/gold.html" title="Permalink to this post">Gold is the same as paper</a></h1>
    <time datetime="2011-01-14" pubdate>January 14, 2011</time>
  </header>
  <div style="float: right; margin-left: 1em; padding: 5px"><a
href="http://www.flickr.com/photos/7159212@N05/442965594/" title="photo by tao_zhyn on Flickr"><img
src="/images/gold.jpg" width="240" height="128" alt="gold coins"
class="facebook-image"></a></div>

<p>We won’t return to a gold standard because changing to a fiat currency was
one of the great innovations of modern economics. You aren’t literally
and figuratively weighed down by gold, and that allows central banks and
governments to set policy that allows them to rebound from crises, spur
growth, and lift people out of poverty and short lifespans. As <a href="http://www.thenation.com/audio/157757/breakdown-should-us-return-gold-standard" title="Episode of The Breakdown with Chris Hayes podcast by The Nation">Liaquat
Ahamed points out</a>, the gold standard is also a sure way to get yourself
in a deflationary cycle.</p>
<p>But, wait! gold bugs will say. That paper isn’t worth the paper it’s
printed on. Gold has <em>real</em> value, that’s why it was the world’s
currency for many years. The problem with this is that money is a
<a href="http://en.wikipedia.org/wiki/Turtles_all_the_way_down">turtles-all-the-way-down</a> concept. Gold is just as much a pointer
to value as paper is, except it has many more downsides: it’s heavier,
more cumbersome to exchange, and has a fixed supply.</p>
<p>Gold isn’t valuable in and of itself. You can’t live in gold. You can’t eat
gold. You can’t clothe yourself in gold. A gold coin can’t paint your house,
or build you a website. You could (hypothetically) use it to put your kids
through college, so it that sense it’s valuable to you, but <em>only in its
exchange</em>, because on the other end, the trustees and professors and janitors
at the college need to live somewhere, eat something, wear something,
and have websites built. And again they exchange it for those goods and
services. So really the only thing that’s intrinsic to this little economy
I’ve just described is the fact that you, the college trustees, the service
providers, et al., all agree on the value or rate of exchange. It’s like
an algebraic equation where constants cancel out — gold is the constant,
so we can abstract it away. It may as well be “neighborhood fun bucks,”
so long as everyone agrees on the rate of exchange for goods and services.</p>
<p>And there you have it. Economies have nothing to do with the particulars of
their currencies, and everything to do with people and institutions trusting
that, in exchange for some amount, I will receive something of perceived
equal value. Trust, and perception. Currencies are just a convenient
means by which we mitigate that exchange, an abstraction, a stand-in
for a hypothetical exchange, ultimately, an exchange built on trust.</p>
<p>Interestingly, the only inherent value gold has is in its use as
jewelry. Which, aside from any aesthetic concerns, couldn’t be more
appropriate for our discussion, because people wear gold jewelry <em>as a
signifier of wealth</em>. A pointer, a marker, an abstraction for the wealth
itself, which, again, is just the potential for exchange.</p>
<p>It is this essential trust network at the core of economics that explains
why there is so much noise about gold. It reflects a lack of trust on the
part of gold advocates in our central banking and governmental institutions,
which they feel pursue policies that aren’t in their interest, or are in
the interest of undeserving populations. The switch to a gold standard,
therefore, has nothing to do with inflation or any other “economic”
concern, and everything to do with pursuing a political objective. The
market of exchange in this little political economy is for ideas about
reprioritizing our institutions. Which is a legitimate topic of national
debate. But reverting to the gold standard, as a practical economic matter,
would be bonkers.</p>
  </article>
<article class="post">
  <header>
    <h1><a href="/blog/2011/01/go.html" title="Permalink to this post">Taking Go for a spin</a></h1>
    <time datetime="2011-01-12" pubdate>January 12, 2011</time>
  </header>
  <p>I was struck by the high-level abstractions <a href="http://golang.org/">Go</a>
provides for writing networked clients and servers, even by the standards of
conventionally high-level languages like Python. Given Go’s identification
as a systems programming language, this is initially surprising, because
such languages tend to be low-level for performance reasons (Go does
expose a lot of low-level interfaces through various packages like <code>os</code>
and <code>syscall</code>), but of course there would be good support for these
things because Go is a modern language designed by folks with many years
of experience writing networked servers.</p>
<p>Specifically, the <code>net</code> package provides the <code>Listener</code> and <code>Conn</code> types
that hide many of the details of setting up socket connections. A simple
<code>net.Listen("tcp", ":1234")</code> is enough to get the equivalent of a listener,
or server, socket. The <code>bufio</code> package provides buffered read methods,
simplifying common tasks like reading lines from a socket.</p>
<p>Let’s dive in and take a look at one way to implement a classic echo
server. I tried to use Go’s language features for concurrent communication,
goroutines and channels, at crucial points. Where a different implementation
in different language might fork a new process or spawn a new thread to
handle a new client connection, a goroutine was started and the details
of the connection communicated with a channel.</p>
<div class="codehilite"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">&quot;net&quot;</span>
    <span class="s">&quot;bufio&quot;</span>
    <span class="s">&quot;strconv&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
<span class="p">)</span>

<span class="k">const</span> <span class="n">PORT</span> <span class="p">=</span> <span class="mi">3540</span>
</pre></div>


<p>All Go programs must have a <code>package main</code>. We declare a number of packages to
be imported, <code>net</code> and <code>bufio</code> already mentioned, <code>strconv</code> for its conversion
function <code>Itoa()</code> that converts an integer to a string, and <code>fmt</code> for printing
strings to the console. Our echo server will listen on port 3540.</p>
<div class="codehilite"><pre><span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">server</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="n">net</span><span class="p">.</span><span class="n">Listen</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span> <span class="s">&quot;:&quot;</span> <span class="p">+</span> <span class="n">strconv</span><span class="p">.</span><span class="n">Itoa</span><span class="p">(</span><span class="n">PORT</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">server</span> <span class="p">==</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">panic</span><span class="p">(</span><span class="s">&quot;couldn&#39;t start listening: &quot;</span> <span class="p">+</span> <span class="n">err</span><span class="p">.</span><span class="n">String</span><span class="p">())</span>
    <span class="p">}</span>
    <span class="n">conns</span> <span class="p">:=</span> <span class="n">clientConns</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="k">go</span> <span class="n">handleConn</span><span class="p">(&lt;-</span><span class="n">conns</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Every Go program must have a function <code>main()</code> in its <code>package main</code>. We start
by declaring and initializing a new listener for our echo server. We choose
the more generic <code>net.Listen()</code> over <code>net.TCPListen()</code>, because we can
conveniently parameterize the type of the listener with a string to the first
argument of <code>Listen</code>. (It is generally preferred in Go to deal with the most
generic type, or interface, especially when writing function and method
signatures, and either allow a specific type to be inferred by the compiler or
specify it when declaring/initializing a variable.) <code>":" + strconv.Itoa(PORT)</code>
is a string concentation expression, and the port constant we defined earlier
is converted to a string. (Strictly, a numeric constant is not an integer of a
particular type, but the string conversion function works here because the
compiler converts the constant into the concrete type to match the function
signature.)</p>
<p>The idiom for Go when handling multiple return values where the last has an
error type is to check the main object for nil, and then <code>panic()</code> with the
stringified error object. This is generally preferred over printing to stderr
and using <code>os.Exit()</code>, because it gives callers higher up the stack the chance
to <code>recover()</code>, sort of a raise/catch exception flow.</p>
<p>Using Go’s compact syntax for simultaneous declaration and initialization, we
set <code>conns</code> to the value of the function call <code>clientConns(server)</code>. This is
the channel we’ll use for getting new client connections.</p>
<p>The equivalent of a infinite loop like <code>while True:</code> or <code>for (;;)</code> in Go is
<code>for { ... }</code>. Each time through the loop, we start a goroutine, calling
<code>handleConn()</code> with the value of the receive operation on our client connections
channel. The unary receive operator <code>&lt;-</code> blocks until a value is available on
the channel, in our case, a new client having connected.</p>
<div class="codehilite"><pre><span class="k">func</span> <span class="n">clientConns</span><span class="p">(</span><span class="n">listener</span> <span class="n">net</span><span class="p">.</span><span class="n">Listener</span><span class="p">)</span> <span class="k">chan</span> <span class="n">net</span><span class="p">.</span><span class="n">Conn</span> <span class="p">{</span>
    <span class="n">ch</span> <span class="p">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="n">net</span><span class="p">.</span><span class="n">Conn</span><span class="p">)</span>
    <span class="n">i</span> <span class="p">:=</span> <span class="mi">0</span>
    <span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">{</span>
            <span class="n">client</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="n">listener</span><span class="p">.</span><span class="n">Accept</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">client</span> <span class="p">==</span> <span class="n">nil</span> <span class="p">{</span>
                <span class="n">fmt</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">&quot;couldn&#39;t accept: &quot;</span> <span class="p">+</span> <span class="n">err</span><span class="p">.</span><span class="n">String</span><span class="p">())</span>
                <span class="k">continue</span>
            <span class="p">}</span>
            <span class="n">i</span><span class="p">++</span>
            <span class="n">fmt</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">&quot;%d: %v &lt;-&gt; %v\n&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">client</span><span class="p">.</span><span class="n">LocalAddr</span><span class="p">(),</span>
                <span class="n">client</span><span class="p">.</span><span class="n">RemoteAddr</span><span class="p">())</span>
            <span class="n">ch</span> <span class="p">&lt;-</span> <span class="n">client</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="n">ch</span>
<span class="p">}</span>
</pre></div>


<p>We create a new channel of type <code>net.Conn</code>, which corresponds to the type that
we’ll get from calling <code>Accept()</code> on our listener connection object. We start
off a new, anonymous goroutine which runs in an infinite loop, constantly
accepting new connections. <code>listener.Accept()</code> blocks as long as there are no
new clients to deal with, but since we’re running inside a goroutine and
"detached" from the main program flow, other already-connected clients can
continue to be handled without interruption (this is where a <code>fork()</code> or a new
thread would happen in a typical server). Instead of <code>panic()</code>ing here if
there is an error connecting with the client, we simply note it on the console
of the server and move on. We also keep track of the number of clients we’ve
seen with the counter <code>i</code>. <code>fmt.Printf()</code> works like you’d expect, though the
<code>%v</code> format is not like anything in C’s <code>printf()</code> — it prints a value in a
default format and works for any type, somewhat like <code>repr()</code> in Python.</p>
<p>The binary <code>&lt;-</code> communication operator is used to send the client, of type
<code>net.Conn</code> to the channel we created at the top. Go has lexical scope (and is
garbage-collected), so <code>ch</code> is available inside the anonymous goroutine and
after our function returns (because the infinite <code>Accept()</code>ing for-loop keeps
the goroutine alive).</p>
<div class="codehilite"><pre><span class="k">func</span> <span class="n">handleConn</span><span class="p">(</span><span class="n">client</span> <span class="n">net</span><span class="p">.</span><span class="n">Conn</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">b</span> <span class="p">:=</span> <span class="n">bufio</span><span class="p">.</span><span class="n">NewReader</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="n">b</span><span class="p">.</span><span class="n">ReadBytes</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span> <span class="p">!=</span> <span class="n">nil</span> <span class="p">{</span> <span class="c1">// EOF, or worse</span>
            <span class="k">break</span>
        <span class="p">}</span>
        <span class="n">client</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>As we saw back in <code>main()</code>, <code>handleConn()</code> is invoked as a goroutine with each
new client connection (the connection being received from the other side of
the channel we just created). <code>bufio.NewReader()</code> wraps the client object with
a nicer interface for reading lines of bytes from. If we decided to use the
<code>Read()</code> method of the <code>net.Conn</code> object, our code would be more complex,
having to check for the substring <code>"\n"</code> and testing for EOF. Instead, we can
treat this as a line-oriented protocol, and simply get a line and write it
back to the client, as long as there are lines to be read.</p>
<p><a href="https://gist.github.com/775764">Here’s the whole thing</a>.</p>
<p>The pattern of getting new connections from a channel and starting a goroutine
to handle them is conceptually clean, and also happens to be a straightforward
way to write a multiplexing, concurrent server.</p>
  </article>
<article class="post">
  <header>
    <h1><a href="/blog/2010/12/oplop.html" title="Permalink to this post">Use Oplop for your web site passwords</a></h1>
    <time datetime="2010-12-18" pubdate>December 18, 2010</time>
  </header>
  <div style="float: right; margin-left: 1em; padding: 5px"><a href="http://www.flickr.com/photos/slieschke/226873460/" title="Secure password of the week by Simon Lieschke, on Flickr"><img src="http://farm1.static.flickr.com/85/226873460_c8eabd2911_m.jpg" width="240" height="180" alt="Secure password of the week" /></a></div>

<p>The <a href="http://news.google.com/?q=gawker+breach">Gawker breach</a> made mainstream what’s been known for a
while: we don’t use good passwords, and we use the same password over
and over again on multiple sites, exposing us to a potential chain
reaction of account intrusions if it is uncovered.</p>
<p>One way to address this problem is to use a password generator—the
idea is that all you have to remember is a single, good, strong
password, and the password generator will spit out a random string of
characters to be used as a password on a particular site. This
generated password is hard for an attacker to guess, and hard for them
to “crack” with password-attacking software. You’re not supposed to
remember or even care what the actual password is: you just remember
the master password. And if one of the sites you have an account with
is compromised, it may suck for you with respect to your sensitive
information on that site, but because the generated password is unique
to the site, you’re safe from having it used against you on other
sites where you have accounts.</p>
<img src="/images/oplop-screenshot.png" alt="Oplop screenshot"
style="float: left; margin-right: 1em; padding: 5px">

<p>The password generator I use is called <a href="https://oplop.appspot.com/">Oplop</a>. It’s just a web
site, so you visit it in your browser; there’s nothing to
install. There are two fields to enter—a nickname, and the master
password. The nickname is any name you want to identify the site or
service for which you need a password. After you enter a nickname and
your master password, you click the “Create” button, and an
unguessable password is generated for you in the field below the
button. Enter that password into the site that’s asking you for a
password, and you’re all done. The next time you visit the site and
need to enter your password, you repeat the process exactly to get the
same unique password that’s just for that site.</p>
<p>There are a few tips and tricks to using Oplop successfully. The
nickname is just a label that you remember to refer to the site you
need a password for, but if it is different by even one character, an
entirely different password will be generated. So it’s important to be
consistent, and ideally use a simple convention so that you enter the
label the same way every time. I’ve chosen a convention of using
all-lowercase and no non-alphanumeric characters, and the domain name
of the site, minus the top-level domain (the .com or .org, etc.). For
example, if I’m on amazon.com, I’ll use “amazon” (without the quotes)
for the nickname. If I was visiting a site with the domain name
“Cat-Pics-123.net”, I’d use “catpics123” for the nickname. Whatever
your convention for nicknames, it should be simple and you should use
it consistently.</p>
<p>Your master password should be a good one—fairly long and hard to
guess—since it is the key to the kingdom. Security researchers often
praise the idea of “passphrase,” a sentence instead of a single
word. These can often be easier to remember and are just as strong if
not stronger than shorter, gobbledygook passwords, even if the
passphrase is composed of simple words. A four or five word sentence,
separated with spaces, should suffice, although longer passphrases are
even better. In any case, use care when entering your master password
into Oplop. By default, it doesn’t do any checking, so, like in the
case of the nickname, a single character’s difference means a whole
different generated password. You can optionally click on the checkbox
“Validate master password?”, which adds an additional password field
for you to re-enter your master password, providing a simple check
that might catch a typo in the first field.</p>
<p>The final tip is to cut-and-paste the generated password out of its
field instead of copy-and-paste. It’s not so much a tip per se because
Oplop recommends that you do this right on the page, but it’s
important enough to reiterate. Doing it this way prevents someone from
snooping over your shoulder, or if you are careless and leave the
Oplop page open untentionally on a shared computer.</p>
<p>You might have stopped short at the notion of a web-based password
generator. Isn’t it insecure to trust a web site to generate a
password for you? The answer is, you are only actually interacting
with your browser—there is no network activity taking place when you
generate a password with Oplop. That is because the entire Oplop
program is just HTML and JavaScript loaded in your browser, and it is
your browser on your local computer that takes the nickname and master
password, performs the cryptographic magic on them, and outputs the
generated password. In fact, Oplop works offline just as well. You can
test it by visiting the site and bookmarking it on your iPhone or
Android, deleting the browser window, putting the phone in airplane
mode, then loading Oplop from the bookmark. It works just the same as
if you were connected to the internet.</p>
<p>The browser-centric nature of Oplop gets to another key concept about
it—there’s nothing to install. In fact, it is essentially already
installed on any internet-enabled device with a JavaScript-enabled
browser. There’s no central database of account names and generated
passwords, like you might expect, and which password generators like
1Password and Password Gorilla are built around. These programs work
similarly to Oplop in the end result, but their central database
presents a user experience problem—it needs to be shared among the
computers you want to use the program on. This can make it difficult
to retrieve a password if you are on your friend’s laptop or a PC at
an internet café. Not only do you have to install the password
generator software itself, if you are allowed to by policy of the
computer’s owner or manager, you have to synchronize the central
database with the computer. By simply eschewing the notion of storing
account names and passwords, Oplop provides a universally-accessible
password management tool. Those unique generated passwords are just
ephemera, the results of combining the secret you keep in your head
(your master password), the site nicknames, and a cryptographic
function in your computer. Even the notion of the “master password” is
turned on its head—it’s not unlocking some database of passwords, it’s
<a href="http://code.google.com/p/oplop/wiki/HowItWorks">combined with the nickname to make a cryptographic hash</a>, the
bits of which make up the final generated password. You could start
using a different master password at any time, which essentially would
invalidate any extant passwords generated with the old one (you still
would have to manually go in and update each password on each site,
though).</p>
<p>There are other approaches to securing your passwords, including
<a href="http://www.schneier.com/blog/archives/2005/06/write_down_your.html">writing them down</a>. In fact, if you have trouble
remembering strong passwords or passphrases of sufficient length, you
might consider writing down your Oplop master password on a slip of
paper you keep in your wallet.</p>
<p>Oplop is not perfect—it outputs a fixed style of generated passwords
that may not meet the password criteria for various sites and
services, which require certain lengths, or a certain mix of
characters. It also doesn't address the need of strong,
crypotgraphically-secure storage of ad-hoc information such as credit
card numbers and other sensitive account information, which are often
stored alongside passwords and account names in more traditional
central database-style password generator programs. But this is by
design and not a failing of Oplop. I continue to use Password Gorilla
for this scenario, especially for protecting financial
information. Also, there are certain <a href="http://code.google.com/p/oplop/wiki/ThreatModel">threats Oplop can’t protect
against</a>, And it’s worth understanding what they are before
you start using it.</p>
<p>Oplop addresses the proliferation of passwords across multiple web
site accounts, is simple to use, and works everywhere there’s a
browser. So stop using “letmein” for all your web site accounts—you’d
be much better off plugging that in to Oplop as your master
password. But don’t. Use a better one.</p>
  </article>
<article class="post">
  <header>
    <h1><a href="/blog/2010/12/delicious.html" title="Permalink to this post">del.icio.us is dead, long live del.icio.us</a></h1>
    <time datetime="2010-12-17" pubdate>December 17, 2010</time>
  </header>
  <p><img src="/images/delicious-logo.png" alt="Delicious logo"
style="float: right; margin-left: 1em; padding: 5px"> It slipped today
that Yahoo! will soon to shut down <a href="http://delicious.com/">Delicious</a>, née
del.icio.us, the social bookmarking site. When it became obvious a few
years ago care and feeding of the site had more or less stopped, I
fled the service, like many other users, for the clones.</p>
<p>Delicious was important for two reasons. It was all about
discovery—what your friends and the other interesting people you were
following were reading. Predating Digg and reddit, it was the first
service to do what Twitter and Facebook now do so well—point you at a
URL you will probably be interested in, by virtue of having been
vetted by your social network.</p>
<p>It was also important because it popularized "folksonomies," the
now-ubiqitous act of tagging items as a lightweight, and therefore
actually used and useful, alternative to categorization. You can thank
del.icio.us for tag clouds and high-quality Flickr searches, for
example.</p>
<p>Delicious was internet plumbing, but it never became essential
internet plumbing. You could automatically update your blog from it
with what you were reading (and so many people did that they stopped
writing in long-form and just published from their Delicious accounts
a link and some commentary, it resembled an early Twitter-esque
microblog in that way). Lots of people offloaded their brains to it
(especially reference material and how-to guides and programming tips,
learning stuff they intended to come back to later). But unlike its
big Yahoo! sister Flickr, which has become an essential pipeline for
web images, Delicious never grew much beyond what it was in the early
days, never caught fire as a social network in its own right despite
millions of users. Whether this was due to neglect or mismanagement or
cluelessness, in any case, it was a missed opportunity, to become
essential.</p>
<p><a href="https://twitter.com/#!/simonw/status/15519434139508736">People</a> <a href="https://twitter.com/#!/michael_nielsen/status/15511360536313857">are</a> <a href="https://twitter.com/#!/michael_nielsen/status/15515090346315776">wondering</a> if Yahoo!
understands what the shutdown means for their reputation, when it
comes to safeguarding user data or being reliably available. It's a
classic <a href="http://www.dataliberation.org/">data liberation</a> problem, and if Yahoo! doesn't make
it easy for users to take their bookmarks out of Delicious (or their
photos out of Flickr for that matter), folks might not trust a future
Yahoo! product with their data.</p>
<p>Bookmarking lives on despite the fact that you can pretty much Google
anything, replacing the offboard-brain reference index, and that
social network-based discovery is now dominated by Twitter and
Facebook—people still like being able to curate their own little
slice of the web. <a href="http://pinboard.in/">pinboard.in</a> is one post-Delicious site
that looks particularly promising and vital; tellingly, it refers to
itself as anti-social bookmarking.</p>
<p>Farewall, Delicious—for a few years at least, you were essential to
<a href="http://delicious.com/thaislump">me</a>.</p>
  </article>
<article class="post">
  <header>
    <h1><a href="/blog/2010/10/old_things.html" title="Permalink to this post">I know about old things</a></h1>
    <time datetime="2010-10-31" pubdate>October 31, 2010</time>
  </header>
  <p><a href="http://scripting.com/stories/2010/09/23/farewellToThePhone.html">This post by Dave Winer</a> is an example of an observation I’ve seen
made recently, which roughly goes, kids today, they didn’t grow up
with ringing-bell, handset-style telephones, or floppy disks, to name
two obsolete technologies, and so our icons for “call” and “save” in
our software don’t mean anything to them, because they don’t know what
those icons stand for (and by extension, what action is expected to
happen when you click on them). I think this overstates things. We
should always strive for better, more universally-understood metaphors
in our graphical interfaces, to make software easier to use and more
accessible. The idea that future kids won’t know about technologies
that had their heyday prior to their consciousness is belied by the
fact that I know about things before 1977, stuff like kerosene lamps,
telegraphs, and muskets.</p>
<p>Let’s set aside the fact that abstract graphical representations of
physical things, icons, tend to take on lives of their own, semantic
meanings that diverge from their real-world analogues (think folders,
files, and the desktop), so we don’t need to fully understand or even
be aware of the physical object to successfully use the virtual
one. (It’s not as if we had in-born knowledge of telephones and floppy
disks, and similarly we have to learn about software and its metaphors
in their own context.) In part because there is uneven deployment and
obsolescence of technology, in part because of cultural memory like
movies, and in part because of software and the Internet, we will
remember, and especially we will remember technologies that overlap,
in function or metaphor, and which are relevant to our contemporary
technology stories.</p>
  </article>
<article class="post">
  <header>
    <h1><a href="/blog/2010/10/redis.html" title="Permalink to this post">I wrote an article about Redis</a></h1>
    <time datetime="2010-10-18" pubdate>October 18, 2010</time>
  </header>
  <p>I’ve been using Redis more and more lately, and I started poking
around in the source code trying to understand it better. I wrote <a
href="/articles/redis-under-the-hood.html">an article</a> about how
Redis starts up and processes the request/response cycle. I think this
is just the beginning of my Redis explorations—we’re already using it
quite a bit at work, and I have an idea for a new data type that could
be really useful. I plan to write at least one more longish article
like this about it, on following in close detail how a SET and a GET
command make their way through the server.</p>
<p>Redis is an extremely cool project. The main contributors are focused
on making it fast, bug-free, and keeping it small (in the sense of
features, code base, complexity). They're also working on a
distributed version that could be very promising, taking it beyond
what is already IMO a very successful single process model.</p>
  </article>

      <aside>
        
<section>
  <p>Blog archive</p>
  <ul>
    <li><a href="/blog/2010/">2010</a></li>
    <li><a href="/blog/2011/">2011</a></li>
    </ul>
</section>

      </aside>
    </div>
    <footer>
      <p>ⓒ  Paul Smith. Baked with Python.
      <p>Always wrong. Never in doubt.</p>
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
    <script src="/js/tooltip.js"></script>
    
    <script type="text/javascript">
    // Google Analytics
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-304677-1']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </body>
</html>

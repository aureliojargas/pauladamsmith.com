<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>January 2011 blog archive - Paul Smith</title>
    <meta name="description" content="Paul Smith, programmer, EveryBlock co-founder">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans:regular,bold|Inconsolata|Droid+Serif:regular,bold">
    <!--[if gte IE 7]><!-->
    <link rel="stylesheet" media="screen, projection" href="/css/base.css" type="text/css">
    <!-- <![endif]-->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css">
    <link rel="alternate" href="/atom.xml" type="application/atom+xml">
    <link rel="openid.server" href="http://www.myopenid.com/server/">
    <link rel="openid.delegate" href="http://pauladamsmith.myopenid.com/">
    <meta name="verify-v1" content="JGWpUVGeSZp407VK35oscFKsTMIEalzD8cTIBcScWNQ=">
    
  </head>
  <body>
    <header>
      <h1><a href="/">Paul Smith</a></h1>
      <nav>
        <ul>
          <li><a href="/about.html">About</a></li>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/articles/">Articles</a></li>
          <li><a href="/projects.html">Projects</a></li>
        </ul>
      </nav>
    </header>
    <div id="main">
      
<h1>Blog archive for January 2011</h1>
<article class="post">
  <header>
    <h1><a href="/blog/2011/01/bluecollarleague.html" title="Permalink to this post">The All-Blue-Collar League</a></h1>
    <time datetime="2011-01-24" pubdate>January 24, 2011</time>
  </header>
  <p>In honor of the <a href="http://sportsillustrated.cnn.com/football/nfl/gameflash/2011/01/23/4353_recap.html?&amp;eref=sihp">all</a>-<a href="http://sportsillustrated.cnn.com/football/nfl/gameflash/2011/01/23/4354_recap.html?eref=sihp">union</a> Super Bowl, I present the
All-Blue-Collar League, a collection of U.S. professional sports franchises
named after local unions, industry.</p>
<p>In solidarity:</p>
<table id="teams">
    <tr>
        <th>NFL</th>
    </tr>
    <tr class="team packers" title="Named after the Indian Packing Company">
        <td><span></span>Green Bay <b>Packers</b></td>
    </tr>
    <tr class="team steelers" title="Pittsburgh’s economy centered around the steel industry for many years.">
        <td><span></span>Pittsburgh <b>Steelers</b></td>
    </tr>
    <tr class="team cowboys" title="Texas cowboys were freelance livestock herders and handlers.">
        <td><span></span>Dallas <b>Cowboys</b></td>
    </tr>

<tr>
        <th>MLB</th>
    </tr>
    <tr class="team astros" title="NASA’s Johnson Space Center and the greater space industry is a huge employer in the Houston region.">
        <td><span></span>Houston <b>Astros</b></td>
    </tr>
    <tr class="team brewers" title="Named for the city’s association with the beer brewing industry.">
        <td><span></span>Milwaukee <b>Brewers</b></td>
    </tr>
    <tr class="team mariners" title="The city’s location makes it a natural for many maritime industries, including fishmongering, and fishwivery.">
        <td><span></span>Seattle <b>Mariners</b></td>
    </tr>
    <tr class="team rangers" title="The Texas Rangers have been a statewide law enforcement agency since 1823, the oldest such agency in the U.S.">
        <td><span></span>Texas <b>Rangers</b></td>
    </tr>

<tr>
        <th>NBA</th>
    </tr>
    <tr class="team pistons" title="Detroit is synonymous with the American auto industry, a source of high-quality middle-class jobs for most of the 20th century.">
        <td><span></span>Detroit <b>Pistons</b></td>
    </tr>

<tr>
        <th>NHL</th>
    </tr>
    <tr class="team oilers" title="Edmonton is one of Canada’s major oil refinery centers.">
        <td><span></span>Edmonton <b>Oilers</b></td>
    </tr>
</table>

<p>Thanks to <a href="http://twitter.com/kostuch">@kostuch</a>, <a href="http://twitter.com/ikesmith">@ikesmith</a>, <a href="http://twitter.com/joshandrews">@joshandrews</a>, <a href="http://twitter.com/tcarmody">@tcarmody</a>,
<a href="http://twitter.com/lmsahistory">@lmsahistory</a>, and <a href="http://twitter.com/janieporche">@janieporche</a> for suggestions.</p>
<style>
#teams {
    width: 100%;
    margin-bottom: 1em;
}

#teams tr {
    clear: both;
}

#teams th {
    padding: 5px 6px;
}

#teams th {
    background: hsla(215, 35%, 35%, 1.0);
    color: white;
}

#teams td {
    height: 50px;
    line-height: 50px;
    padding: 5px 0;
    border-bottom: 1px solid hsla(215, 35%, 35%, 0.5);
}

#teams td span {
    display: block;
    float: left;
    height: 50px;
    width: 50px;
    margin-right: 10px;
    background-image: url(/images/blue_collar_sprite.png);
    background-repeat: no-repeat;
}

#teams .explanation {
    display: none;
}

.brewers td span { background-position: -50px 0px; }
.cowboys td span { background-position: -100px 0px; }
.mariners td span { background-position: -150px 0px; }
.oilers td span { background-position: -200px 0px; }
.packers td span { background-position: -250px 0px; }
.pistons td span { background-position: -300px 0px; }
.rangers td span { background-position: -350px 0px; }
.steelers td span { background-position: -400px 0px; }
</style>
  </article>
<article class="post">
  <header>
    <h1><a href="/blog/2011/01/gold.html" title="Permalink to this post">Gold is the same as paper</a></h1>
    <time datetime="2011-01-14" pubdate>January 14, 2011</time>
  </header>
  <div style="float: right; margin-left: 1em; padding: 5px"><a
href="http://www.flickr.com/photos/7159212@N05/442965594/" title="photo by tao_zhyn on Flickr"><img
src="/images/gold.jpg" width="240" height="128" alt="gold coins"
class="facebook-image"></a></div>

<p>We won’t return to a gold standard because changing to a fiat currency was
one of the great innovations of modern economics. You aren’t literally
and figuratively weighed down by gold, and that allows central banks and
governments to set policy that allows them to rebound from crises, spur
growth, and lift people out of poverty and short lifespans. As <a href="http://www.thenation.com/audio/157757/breakdown-should-us-return-gold-standard" title="Episode of The Breakdown with Chris Hayes podcast by The Nation">Liaquat
Ahamed points out</a>, the gold standard is also a sure way to get yourself
in a deflationary cycle.</p>
<p>But, wait! gold bugs will say. That paper isn’t worth the paper it’s
printed on. Gold has <em>real</em> value, that’s why it was the world’s
currency for many years. The problem with this is that money is a
<a href="http://en.wikipedia.org/wiki/Turtles_all_the_way_down">turtles-all-the-way-down</a> concept. Gold is just as much a pointer
to value as paper is, except it has many more downsides: it’s heavier,
more cumbersome to exchange, and has a fixed supply.</p>
<p>Gold isn’t valuable in and of itself. You can’t live in gold. You can’t eat
gold. You can’t clothe yourself in gold. A gold coin can’t paint your house,
or build you a website. You could (hypothetically) use it to put your kids
through college, so it that sense it’s valuable to you, but <em>only in its
exchange</em>, because on the other end, the trustees and professors and janitors
at the college need to live somewhere, eat something, wear something,
and have websites built. And again they exchange it for those goods and
services. So really the only thing that’s intrinsic to this little economy
I’ve just described is the fact that you, the college trustees, the service
providers, et al., all agree on the value or rate of exchange. It’s like
an algebraic equation where constants cancel out — gold is the constant,
so we can abstract it away. It may as well be “neighborhood fun bucks,”
so long as everyone agrees on the rate of exchange for goods and services.</p>
<p>And there you have it. Economies have nothing to do with the particulars of
their currencies, and everything to do with people and institutions trusting
that, in exchange for some amount, I will receive something of perceived
equal value. Trust, and perception. Currencies are just a convenient
means by which we mitigate that exchange, an abstraction, a stand-in
for a hypothetical exchange, ultimately, an exchange built on trust.</p>
<p>Interestingly, the only inherent value gold has is in its use as
jewelry. Which, aside from any aesthetic concerns, couldn’t be more
appropriate for our discussion, because people wear gold jewelry <em>as a
signifier of wealth</em>. A pointer, a marker, an abstraction for the wealth
itself, which, again, is just the potential for exchange.</p>
<p>It is this essential trust network at the core of economics that explains
why there is so much noise about gold. It reflects a lack of trust on the
part of gold advocates in our central banking and governmental institutions,
which they feel pursue policies that aren’t in their interest, or are in
the interest of undeserving populations. The switch to a gold standard,
therefore, has nothing to do with inflation or any other “economic”
concern, and everything to do with pursuing a political objective. The
market of exchange in this little political economy is for ideas about
reprioritizing our institutions. Which is a legitimate topic of national
debate. But reverting to the gold standard, as a practical economic matter,
would be bonkers.</p>
  </article>
<article class="post">
  <header>
    <h1><a href="/blog/2011/01/go.html" title="Permalink to this post">Taking Go for a spin</a></h1>
    <time datetime="2011-01-12" pubdate>January 12, 2011</time>
  </header>
  <p>I was struck by the high-level abstractions <a href="http://golang.org/">Go</a>
provides for writing networked clients and servers, even by the standards of
conventionally high-level languages like Python. Given Go’s identification
as a systems programming language, this is initially surprising, because
such languages tend to be low-level for performance reasons (Go does
expose a lot of low-level interfaces through various packages like <code>os</code>
and <code>syscall</code>), but of course there would be good support for these
things because Go is a modern language designed by folks with many years
of experience writing networked servers.</p>
<p>Specifically, the <code>net</code> package provides the <code>Listener</code> and <code>Conn</code> types
that hide many of the details of setting up socket connections. A simple
<code>net.Listen("tcp", ":1234")</code> is enough to get the equivalent of a listener,
or server, socket. The <code>bufio</code> package provides buffered read methods,
simplifying common tasks like reading lines from a socket.</p>
<p>Let’s dive in and take a look at one way to implement a classic echo
server. I tried to use Go’s language features for concurrent communication,
goroutines and channels, at crucial points. Where a different implementation
in different language might fork a new process or spawn a new thread to
handle a new client connection, a goroutine was started and the details
of the connection communicated with a channel.</p>
<div class="codehilite"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">&quot;net&quot;</span>
    <span class="s">&quot;bufio&quot;</span>
    <span class="s">&quot;strconv&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
<span class="p">)</span>

<span class="k">const</span> <span class="n">PORT</span> <span class="p">=</span> <span class="mi">3540</span>
</pre></div>


<p>All Go programs must have a <code>package main</code>. We declare a number of packages to
be imported, <code>net</code> and <code>bufio</code> already mentioned, <code>strconv</code> for its conversion
function <code>Itoa()</code> that converts an integer to a string, and <code>fmt</code> for printing
strings to the console. Our echo server will listen on port 3540.</p>
<div class="codehilite"><pre><span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">server</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="n">net</span><span class="p">.</span><span class="n">Listen</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span> <span class="s">&quot;:&quot;</span> <span class="p">+</span> <span class="n">strconv</span><span class="p">.</span><span class="n">Itoa</span><span class="p">(</span><span class="n">PORT</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">server</span> <span class="p">==</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">panic</span><span class="p">(</span><span class="s">&quot;couldn&#39;t start listening: &quot;</span> <span class="p">+</span> <span class="n">err</span><span class="p">.</span><span class="n">String</span><span class="p">())</span>
    <span class="p">}</span>
    <span class="n">conns</span> <span class="p">:=</span> <span class="n">clientConns</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="k">go</span> <span class="n">handleConn</span><span class="p">(&lt;-</span><span class="n">conns</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Every Go program must have a function <code>main()</code> in its <code>package main</code>. We start
by declaring and initializing a new listener for our echo server. We choose
the more generic <code>net.Listen()</code> over <code>net.TCPListen()</code>, because we can
conveniently parameterize the type of the listener with a string to the first
argument of <code>Listen</code>. (It is generally preferred in Go to deal with the most
generic type, or interface, especially when writing function and method
signatures, and either allow a specific type to be inferred by the compiler or
specify it when declaring/initializing a variable.) <code>":" + strconv.Itoa(PORT)</code>
is a string concentation expression, and the port constant we defined earlier
is converted to a string. (Strictly, a numeric constant is not an integer of a
particular type, but the string conversion function works here because the
compiler converts the constant into the concrete type to match the function
signature.)</p>
<p>The idiom for Go when handling multiple return values where the last has an
error type is to check the main object for nil, and then <code>panic()</code> with the
stringified error object. This is generally preferred over printing to stderr
and using <code>os.Exit()</code>, because it gives callers higher up the stack the chance
to <code>recover()</code>, sort of a raise/catch exception flow.</p>
<p>Using Go’s compact syntax for simultaneous declaration and initialization, we
set <code>conns</code> to the value of the function call <code>clientConns(server)</code>. This is
the channel we’ll use for getting new client connections.</p>
<p>The equivalent of a infinite loop like <code>while True:</code> or <code>for (;;)</code> in Go is
<code>for { ... }</code>. Each time through the loop, we start a goroutine, calling
<code>handleConn()</code> with the value of the receive operation on our client connections
channel. The unary receive operator <code>&lt;-</code> blocks until a value is available on
the channel, in our case, a new client having connected.</p>
<div class="codehilite"><pre><span class="k">func</span> <span class="n">clientConns</span><span class="p">(</span><span class="n">listener</span> <span class="n">net</span><span class="p">.</span><span class="n">Listener</span><span class="p">)</span> <span class="k">chan</span> <span class="n">net</span><span class="p">.</span><span class="n">Conn</span> <span class="p">{</span>
    <span class="n">ch</span> <span class="p">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="n">net</span><span class="p">.</span><span class="n">Conn</span><span class="p">)</span>
    <span class="n">i</span> <span class="p">:=</span> <span class="mi">0</span>
    <span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">{</span>
            <span class="n">client</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="n">listener</span><span class="p">.</span><span class="n">Accept</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">client</span> <span class="p">==</span> <span class="n">nil</span> <span class="p">{</span>
                <span class="n">fmt</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">&quot;couldn&#39;t accept: &quot;</span> <span class="p">+</span> <span class="n">err</span><span class="p">.</span><span class="n">String</span><span class="p">())</span>
                <span class="k">continue</span>
            <span class="p">}</span>
            <span class="n">i</span><span class="p">++</span>
            <span class="n">fmt</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">&quot;%d: %v &lt;-&gt; %v\n&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">client</span><span class="p">.</span><span class="n">LocalAddr</span><span class="p">(),</span>
                <span class="n">client</span><span class="p">.</span><span class="n">RemoteAddr</span><span class="p">())</span>
            <span class="n">ch</span> <span class="p">&lt;-</span> <span class="n">client</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="n">ch</span>
<span class="p">}</span>
</pre></div>


<p>We create a new channel of type <code>net.Conn</code>, which corresponds to the type that
we’ll get from calling <code>Accept()</code> on our listener connection object. We start
off a new, anonymous goroutine which runs in an infinite loop, constantly
accepting new connections. <code>listener.Accept()</code> blocks as long as there are no
new clients to deal with, but since we’re running inside a goroutine and
"detached" from the main program flow, other already-connected clients can
continue to be handled without interruption (this is where a <code>fork()</code> or a new
thread would happen in a typical server). Instead of <code>panic()</code>ing here if
there is an error connecting with the client, we simply note it on the console
of the server and move on. We also keep track of the number of clients we’ve
seen with the counter <code>i</code>. <code>fmt.Printf()</code> works like you’d expect, though the
<code>%v</code> format is not like anything in C’s <code>printf()</code> — it prints a value in a
default format and works for any type, somewhat like <code>repr()</code> in Python.</p>
<p>The binary <code>&lt;-</code> communication operator is used to send the client, of type
<code>net.Conn</code> to the channel we created at the top. Go has lexical scope (and is
garbage-collected), so <code>ch</code> is available inside the anonymous goroutine and
after our function returns (because the infinite <code>Accept()</code>ing for-loop keeps
the goroutine alive).</p>
<div class="codehilite"><pre><span class="k">func</span> <span class="n">handleConn</span><span class="p">(</span><span class="n">client</span> <span class="n">net</span><span class="p">.</span><span class="n">Conn</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">b</span> <span class="p">:=</span> <span class="n">bufio</span><span class="p">.</span><span class="n">NewReader</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="n">b</span><span class="p">.</span><span class="n">ReadBytes</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span> <span class="p">!=</span> <span class="n">nil</span> <span class="p">{</span> <span class="c1">// EOF, or worse</span>
            <span class="k">break</span>
        <span class="p">}</span>
        <span class="n">client</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>As we saw back in <code>main()</code>, <code>handleConn()</code> is invoked as a goroutine with each
new client connection (the connection being received from the other side of
the channel we just created). <code>bufio.NewReader()</code> wraps the client object with
a nicer interface for reading lines of bytes from. If we decided to use the
<code>Read()</code> method of the <code>net.Conn</code> object, our code would be more complex,
having to check for the substring <code>"\n"</code> and testing for EOF. Instead, we can
treat this as a line-oriented protocol, and simply get a line and write it
back to the client, as long as there are lines to be read.</p>
<p><a href="https://gist.github.com/775764">Here’s the whole thing</a>.</p>
<p>The pattern of getting new connections from a channel and starting a goroutine
to handle them is conceptually clean, and also happens to be a straightforward
way to write a multiplexing, concurrent server.</p>
  </article>

      <aside>
        
      </aside>
    </div>
    <footer>
      <p>ⓒ  Paul Smith. Baked with Python.
      <p>Always wrong. Never in doubt.</p>
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
    <script src="/js/tooltip.js"></script>
    
    <script type="text/javascript">
    // Google Analytics
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-304677-1']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </body>
</html>
